<div class="register-page">
  <div class="register-container">
    <div class="register-header">
      <h1 class="register-title">Create Account</h1>
      <p class="register-subtitle">Join KickZone and book your field</p>
    </div>

    <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" novalidate class="register-form">
      <div class="form-row">
        <div class="form-group">
          <label for="name" class="form-label">
            <mat-icon class="label-icon">badge</mat-icon>
            Full Name
          </label>
          <input
            id="name"
            formControlName="name"
            type="text"
            class="form-input"
            placeholder="Enter your full name"
            [class.invalid]="f['name'].touched && f['name'].errors"
          />
          <div class="error-message" *ngIf="f['name'].touched && f['name'].errors?.['required']">
            <mat-icon class="error-icon">error</mat-icon>
            Full name is required
          </div>
        </div>

        <div class="form-group">
          <label for="userName" class="form-label">
            <mat-icon class="label-icon">person</mat-icon>
            Username
          </label>
          <input
            id="userName"
            formControlName="userName"
            type="text"
            class="form-input"
            placeholder="Choose a username"
            [class.invalid]="f['userName'].touched && f['userName'].errors"
          />
          <div
            class="error-message"
            *ngIf="f['userName'].touched && f['userName'].errors?.['required']"
          >
            <mat-icon class="error-icon">error</mat-icon>
            Username is required
          </div>
          <div
            class="error-message"
            *ngIf="f['userName'].touched && f['userName'].errors?.['minlength']"
          >
            <mat-icon class="error-icon">error</mat-icon>
            Username must be at least 3 characters
          </div>
          <div class="checking-message" *ngIf="f['userName'].pending">
            <mat-icon class="checking-icon">hourglass_empty</mat-icon>
            Checking availability...
          </div>
          <div
            class="error-message"
            *ngIf="f['userName'].touched && f['userName'].errors?.['usernameTaken']"
          >
            <mat-icon class="error-icon">error</mat-icon>
            This username is already taken
          </div>
          <div class="success-message" *ngIf="f['userName'].valid && !f['userName'].pending && f['userName'].value">
            <mat-icon class="success-icon">check_circle</mat-icon>
            Username is available
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="email" class="form-label">
          <mat-icon class="label-icon">email</mat-icon>
          Email Address
        </label>
        <input
          id="email"
          formControlName="email"
          type="email"
          class="form-input"
          placeholder="Enter your email"
          [class.invalid]="f['email'].touched && f['email'].errors"
        />
        <div class="error-message" *ngIf="f['email'].touched && f['email'].errors?.['required']">
          <mat-icon class="error-icon">error</mat-icon>
          Email is required
        </div>
        <div class="error-message" *ngIf="f['email'].touched && f['email'].errors?.['email']">
          <mat-icon class="error-icon">error</mat-icon>
          Please enter a valid email
        </div>
        <div class="checking-message" *ngIf="f['email'].pending">
          <mat-icon class="checking-icon">hourglass_empty</mat-icon>
          Checking availability...
        </div>
        <div class="error-message" *ngIf="f['email'].touched && f['email'].errors?.['emailTaken']">
          <mat-icon class="error-icon">error</mat-icon>
          This email is already registered
        </div>
        <div class="success-message" *ngIf="f['email'].valid && !f['email'].pending && f['email'].value">
          <mat-icon class="success-icon">check_circle</mat-icon>
          Email is available
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label for="phoneNumber" class="form-label">
            <mat-icon class="label-icon">phone</mat-icon>
            Phone Number
          </label>
          <input
            id="phoneNumber"
            formControlName="phoneNumber"
            type="text"
            class="form-input"
            placeholder="01X XXXX XXXX"
            [class.invalid]="f['phoneNumber'].touched && f['phoneNumber'].errors"
          />
          <div
            class="error-message"
            *ngIf="f['phoneNumber'].touched && f['phoneNumber'].errors?.['required']"
          >
            <mat-icon class="error-icon">error</mat-icon>
            Phone is required
          </div>
          <div
            class="error-message"
            *ngIf="f['phoneNumber'].touched && f['phoneNumber'].errors?.['pattern']"
          >
            <mat-icon class="error-icon">error</mat-icon>
            Must be 11 digits starting with 010/011/012/015
          </div>
          <div class="checking-message" *ngIf="f['phoneNumber'].pending">
            <mat-icon class="checking-icon">hourglass_empty</mat-icon>
            Checking availability...
          </div>
          <div
            class="error-message"
            *ngIf="f['phoneNumber'].touched && f['phoneNumber'].errors?.['phoneTaken']"
          >
            <mat-icon class="error-icon">error</mat-icon>
            This phone number is already registered
          </div>
          <div class="success-message" *ngIf="f['phoneNumber'].valid && !f['phoneNumber'].pending && f['phoneNumber'].value">
            <mat-icon class="success-icon">check_circle</mat-icon>
            Phone number is available
          </div>
        </div>

        <div class="form-group">
          <label for="location" class="form-label">
            <mat-icon class="label-icon">location_on</mat-icon>
            Location
          </label>
          <input
            id="location"
            formControlName="location"
            type="text"
            class="form-input"
            placeholder="Enter your city (optional)"
            [class.invalid]="f['location'].touched && f['location'].errors"
          />
        </div>
      </div>

      <div class="form-group">
        <label for="role" class="form-label">
          <mat-icon class="label-icon">supervisor_account</mat-icon>
          I am a
        </label>
        <select id="role" formControlName="role" class="form-select">
          <option value="User">Player (Book Fields)</option>
          <option value="FieldOwner">Field Owner (List Fields)</option>
        </select>
      </div>

      <div class="form-group">
        <label for="password" class="form-label">
          <mat-icon class="label-icon">lock</mat-icon>
          Password
        </label>
        <div class="password-input-wrapper">
          <input
            id="password"
            formControlName="password"
            [type]="showPassword ? 'text' : 'password'"
            class="form-input password-input"
            placeholder="Create a strong password"
            [class.invalid]="f['password'].touched && f['password'].errors"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility()"
            mat-icon-button
            aria-label="Toggle password visibility"
          >
            <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </div>
        <div
          class="error-message"
          *ngIf="f['password'].touched && f['password'].errors?.['required']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Password is required
        </div>
        <div
          class="error-message"
          *ngIf="f['password'].touched && f['password'].errors?.['minlength']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Password must be at least 6 characters
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword" class="form-label">
          <mat-icon class="label-icon">lock_clock</mat-icon>
          Confirm Password
        </label>
        <div class="password-input-wrapper">
          <input
            id="confirmPassword"
            formControlName="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            class="form-input password-input"
            placeholder="Re-enter your password"
            [class.invalid]="f['confirmPassword'].touched && (f['confirmPassword'].errors || registerForm.errors?.['passwordMismatch'])"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="toggleConfirmPasswordVisibility()"
            mat-icon-button
            aria-label="Toggle confirm password visibility"
          >
            <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </div>
        <div
          class="error-message"
          *ngIf="f['confirmPassword'].touched && f['confirmPassword'].errors?.['required']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Please confirm your password
        </div>
        <div
          class="error-message"
          *ngIf="f['confirmPassword'].touched && registerForm.errors?.['passwordMismatch'] && !f['confirmPassword'].errors?.['required']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Passwords do not match
        </div>
      </div>

      <button type="submit" class="register-button" [disabled]="registerForm.invalid || loading">
        <span *ngIf="!loading" class="button-content">
          <mat-icon>how_to_reg</mat-icon>
          <span>Create Account</span>
        </span>
        <span *ngIf="loading" class="button-content loading">
          <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
          <span>Creating account...</span>
        </span>
      </button>

      <div class="login-prompt">
        <span>Already have an account?</span>
        <a [routerLink]="['/login']" class="login-link">Sign In</a>
      </div>

      <div class="login-prompt">
        <span>Didn't receive verification email?</span>
        <a [routerLink]="['/resend-verification']" class="login-link">Resend</a>
      </div>
    </form>
  </div>
</div>
