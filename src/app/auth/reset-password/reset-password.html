<div class="reset-password-page">
  <div class="reset-password-container">
    @if (!resetSuccess) {
    <div class="reset-password-header">
      <div class="icon-wrapper">
        <mat-icon class="header-icon">lock_open</mat-icon>
      </div>
      <h1 class="reset-password-title">Reset Password</h1>
      <p class="reset-password-subtitle">
        Enter your new password below
      </p>
    </div>

    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" novalidate class="reset-password-form">
      <div class="form-group">
        <label for="newPassword" class="form-label">
          <mat-icon class="label-icon">lock</mat-icon>
          New Password
        </label>
        <div class="password-input-wrapper">
          <input
            id="newPassword"
            formControlName="newPassword"
            [type]="showPassword ? 'text' : 'password'"
            class="form-input password-input"
            placeholder="Enter new password"
            [class.invalid]="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.invalid"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="togglePasswordVisibility()"
            mat-icon-button
            aria-label="Toggle password visibility"
          >
            <mat-icon>{{ showPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </div>
        <div
          class="error-message"
          *ngIf="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.errors?.['required']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Password is required
        </div>
        <div
          class="error-message"
          *ngIf="resetPasswordForm.get('newPassword')?.touched && resetPasswordForm.get('newPassword')?.errors?.['minlength']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Password must be at least 6 characters
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword" class="form-label">
          <mat-icon class="label-icon">lock_clock</mat-icon>
          Confirm Password
        </label>
        <div class="password-input-wrapper">
          <input
            id="confirmPassword"
            formControlName="confirmPassword"
            [type]="showConfirmPassword ? 'text' : 'password'"
            class="form-input password-input"
            placeholder="Confirm new password"
            [class.invalid]="resetPasswordForm.get('confirmPassword')?.touched && (resetPasswordForm.get('confirmPassword')?.invalid || resetPasswordForm.errors?.['passwordMismatch'])"
          />
          <button
            type="button"
            class="password-toggle"
            (click)="toggleConfirmPasswordVisibility()"
            mat-icon-button
            aria-label="Toggle confirm password visibility"
          >
            <mat-icon>{{ showConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
          </button>
        </div>
        <div
          class="error-message"
          *ngIf="resetPasswordForm.get('confirmPassword')?.touched && resetPasswordForm.get('confirmPassword')?.errors?.['required']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Please confirm your password
        </div>
        <div
          class="error-message"
          *ngIf="resetPasswordForm.get('confirmPassword')?.touched && resetPasswordForm.errors?.['passwordMismatch']"
        >
          <mat-icon class="error-icon">error</mat-icon>
          Passwords do not match
        </div>
      </div>

      <button type="submit" class="submit-button" [disabled]="resetPasswordForm.invalid || loading">
        <span *ngIf="!loading" class="button-content">
          <mat-icon>check_circle</mat-icon>
          <span>Reset Password</span>
        </span>
        <span *ngIf="loading" class="button-content loading">
          <mat-spinner diameter="20" class="button-spinner"></mat-spinner>
          <span>Resetting...</span>
        </span>
      </button>
    </form>
    } @else {
    <div class="success-message">
      <div class="success-icon-wrapper">
        <mat-icon class="success-icon">check_circle</mat-icon>
      </div>
      <h2 class="success-title">Password Reset Successfully!</h2>
      <p class="success-text">
        Your password has been reset successfully. You can now log in with your new password.
      </p>
      <button mat-flat-button class="login-button" (click)="goToLogin()">
        <mat-icon>login</mat-icon>
        <span>Go to Login</span>
      </button>
    </div>
    }
  </div>
</div>
