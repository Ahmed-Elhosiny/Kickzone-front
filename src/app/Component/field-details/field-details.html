@switch (uiState()) {

<!-- ================= LOADING ================= -->
@case ('loading') {
  <div class="loading">
    <mat-spinner></mat-spinner>
    <p>Loading field details...</p>
  </div>
}

<!-- ================= ERROR ================= -->
@case ('error') {
  <div class="error">
    <mat-icon>error_outline</mat-icon>
    <h2>Something went wrong</h2>
    <p>{{ errorMessage() }}</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back
    </button>
  </div>
}

<!-- ================= CONTENT ================= -->
@case ('ready') {
  @if (field(); as fieldData) {

  <!-- HEADER -->
  <header class="header">
    <button mat-icon-button (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
    </button>

    <div>
      <h1>{{ fieldData.name }}</h1>
      <div class="meta">
        <span>
          <mat-icon>sports_soccer</mat-icon>
          {{ fieldData.categoryName }}
        </span>
        <span>
          <mat-icon>location_on</mat-icon>
          {{ fieldData.cityName }}
        </span>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container">

    <!-- IMAGE GALLERY -->
    <section class="gallery">
      @if (hasImages()) {
        <div class="image-wrapper">
          <img
            [src]="currentImage()?.imageUrl"
            alt="Field image"
          />

          @if (fieldData.fieldImages.length > 1) {
            <button class="nav left" (click)="prevImage()">‹</button>
            <button class="nav right" (click)="nextImage()">›</button>
          }
        </div>

        <div class="thumbnails">
          @for (img of fieldData.fieldImages; track img.id; let i = $index) {
            <img
              [src]="img.imageUrl"
              [class.active]="i === selectedImageIndex()"
              (click)="selectImage(i)"
            />
          }
        </div>
      } @else {
        <div class="no-image">
          <mat-icon>image_not_supported</mat-icon>
          <p>No images available</p>
        </div>
      }
    </section>

    <!-- INFO -->
    <section class="info">
      <mat-card>
        <h3>Details</h3>

        <div class="row">
          <span>Size</span>
          <strong>{{ formatSize(fieldData.size) }}</strong>
        </div>

        <div class="row">
          <span>Hours</span>
          <strong>{{ fieldData.openAt }}:00 - {{ fieldData.closeAt }}:00</strong>
        </div>

        <div class="row price">
          <span>Price / Hour</span>
          <strong>{{ fieldData.pricePerHour | currency:'EGP' }}</strong>
        </div>

        <div class="row">
          <span>Owner</span>
          <button mat-button (click)="openOwnerContact($event)">
            {{ fieldData.ownerName }}
          </button>
        </div>
      </mat-card>

      <mat-card>
        <h3>Location</h3>
        <p>{{ fieldData.location }}, {{ fieldData.cityName }}</p>

        <button mat-raised-button color="primary" (click)="openMap()">
          <mat-icon>map</mat-icon>
          Open in Google Maps
        </button>
      </mat-card>
    </section>

    <!-- TIME SLOTS -->
    <section class="booking">
      <h2>
        <mat-icon>event_available</mat-icon>
        Available Slots
      </h2>
      <app-time-slot [fieldSignal]="fieldData"></app-time-slot>
    </section>

  </main>
  }
}
}
