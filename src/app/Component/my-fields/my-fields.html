<div class="my-fields-container">
  <div class="page-header">
    <div>
      <h1>My Fields</h1>
      <p>Manage your field listings</p>
    </div>

    <a routerLink="/field-owner/add-field" class="btn btn-primary">
      ‚ûï Add New Field
    </a>
  </div>

  @if (successMessage()) {
    <div class="alert alert-success">{{ successMessage() }}</div>
  }

  @if (errorMessage()) {
    <div class="alert alert-error">{{ errorMessage() }}</div>
  }

  @if (isLoading()) {
    <div class="loading-container">
      <div class="spinner"></div>
      <p>Loading your fields...</p>
    </div>
  }

  @if (!isLoading() && !hasFields()) {
    <div class="empty-state">
      <h2>No fields yet</h2>
      <a routerLink="/field-owner/add-field" class="btn btn-primary">
        Add Your First Field
      </a>
    </div>
  }

  @if (!isLoading() && hasFields()) {
    <div class="fields-grid">
      @for (field of fields(); track field.id) {
        <div class="field-card">
          <div class="field-image">
            <img [src]="getMainImage(field)" />
            <span class="status-badge" [ngClass]="getStatusClass(field)">
              {{ getStatusText(field) }}
            </span>
          </div>

          <div class="field-content">
            <h3>{{ field.name }}</h3>

            <p><strong>City:</strong> {{ field.cityName }}</p>
            <p><strong>Price:</strong> {{ field.pricePerHour }} EGP/hour</p>
            <p><strong>Hours:</strong> {{ field.openAt }} - {{ field.closeAt }}</p>

            @if (!field.hasApprovalDocument || field.isApproved === false) {
              <label
                class="btn btn-primary btn-sm"
                [class.loading]="uploadingDocId() === field.id"
                [for]="'doc-' + field.id"
              >
                {{ uploadingDocId() === field.id ? 'Uploading‚Ä¶' : 'üìÑ Upload Document' }}
              </label>

              <input
                type="file"
                accept=".pdf"
                hidden
                [id]="'doc-' + field.id"
                (change)="uploadDocument(field.id, $event)"
                [disabled]="uploadingDocId() === field.id"
              />
            }

            <div class="actions">
              <button
                class="btn btn-secondary btn-sm"
                (click)="editField(field.id)"
                [disabled]="field.isApproved !== true"
              >
                ‚úèÔ∏è Edit
              </button>

              <button
                class="btn btn-danger btn-sm"
                (click)="confirmDelete(field.id)"
              >
                üóëÔ∏è Delete
              </button>
            </div>
          </div>
        </div>
      }
    </div>
  }

  @if (deleteConfirmId() !== null) {
    <div class="modal-overlay" (click)="cancelDelete()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <h2>Confirm Deletion</h2>
        <p>This action cannot be undone.</p>
        <button class="btn btn-secondary" (click)="cancelDelete()">Cancel</button>
        <button class="btn btn-danger" (click)="deleteField(deleteConfirmId()!)">
          Delete
        </button>
      </div>
    </div>
  }
</div>
